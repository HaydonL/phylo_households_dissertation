#library(parallel)
#n_cores <- detectCores() - 1
source(here::here("helper-functions", "plot_normal.R"))
ages <- seq(15.5, 49.5, by = 1)
draws <- seq(100, 5000, by = 100)
grid <- expand.grid(ages, ages)
final_intensities <- list() # one entry per group
eta_draws <- as_draws_matrix(fit_norm$draws("eta"))
for (group in 1:4){
# Calculate densities for 50 iterations
intensities <- lapply(draws, plot_normal, fit = fit_norm, chain_no = 1,
group_no = group, ages = ages, plot = FALSE)
etas <- as.numeric(eta_draws[draws, group])
for (index in 1:length(etas)){
intensities[[index]] <- etas[index] * intensities[[index]]
}
# Calculate mean density
intensity_matrix <- matrix(unlist(intensities), nrow = 50, byrow = TRUE)
final_intensity <- apply(intensity_matrix, 2, mean)
final_intensities[[group]] <- final_intensity
}
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
src_15_24_indices
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid
intensity_FM_HH
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_int_FM_OOH <- intensity_FM_OOH[src_15_24_indices, ]
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_int_FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_int_FM_HH <- intensity_FM_HH[src_15_24_indices]
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_int_FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_int_FM_HH <- intensity_FM_HH[src_15_24_indices]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
yng_DT <- set
yng_grid
yng_int_FM_HH
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
str(yng_grid)
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
yng_grid[, sum(FM_OOH), by = Var1]
yng_grid
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
#yng_grid[, sum(FM_OOH), by = Var1]
yng_grid
a <- yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
a
print(a)
View(a)
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
a <- yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
first <- as.numeric(yng_grid[1, .(FM_OOH_sum)])
first
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
a <- yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
first <- as.numeric(yng_grid[1, .(FM_OOH_sum)])
yng_grid[FM_OOH_sum == first]
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
a <- yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
first <- as.numeric(yng_grid[1, .(FM_OOH_sum)])
b <- yng_grid[FM_OOH_sum == first]
b
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
a <- yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var2]
first <- as.numeric(yng_grid[1, .(FM_OOH_sum)])
b <- yng_grid[FM_OOH_sum == first]
b
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var2]
yng_grid
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var1 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var2]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var2]
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var2 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var2]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var2]
yng
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var2 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
yng
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var2 < 24)
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
src_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[src_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[src_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[src_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Drop unnecessary columns
yng_grid[, .(FM_OOH, FM_HH, Var2) := NULL]
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Drop unnecessary columns
yng_grid[, c("FM_OOH", "FM_HH", "Var2") := NULL]
yng_grid
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Drop unnecessary columns
yng_grid[, c("FM_OOH", "FM_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid) + geom_line(aes(x = Var1, y = FM_OOH_sum)) +
geom_line(aes(x = Var1, y = FM_HH_sum))
print(p)
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Drop unnecessary columns
yng_grid[, c("FM_OOH", "FM_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = FM_OOH_sum), color = "Out-of-household") +
geom_line(aes(y = FM_HH_sum), color = "Within household")
p
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Drop unnecessary columns
yng_grid[, c("FM_OOH", "FM_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = FM_OOH_sum), color = "red") +
geom_line(aes(y = FM_HH_sum), color = "blue")
p
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Drop unnecessary columns
yng_grid[, c("FM_OOH", "FM_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = FM_OOH_sum), color = "red") +
geom_line(aes(y = FM_HH_sum), color = "blue") +
labs(x = "Age of source", y = "Relative intensity")
p
# Extract relevant intensities and combine into one data.table
intensity_MF_OOH <- final_intensities[[3]]
intensity_MF_HH <- final_intensities[[4]]
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_MF_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_MF_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, MF_OOH_sum := sum(MF_OOH), by = Var1]
# Extract relevant intensities and combine into one data.table
intensity_MF_OOH <- final_intensities[[3]]
intensity_MF_HH <- final_intensities[[4]]
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$MF_OOH <- intensity_MF_OOH[recip_15_24_indices]
yng_grid$MF_HH <- intensity_MF_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, MF_OOH_sum := sum(MF_OOH), by = Var1]
yng_grid[, MF_HH_sum := sum(MF_HH), by = Var1]
# Drop unnecessary columns
yng_grid[, c("MF_OOH", "MF_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = MF_OOH_sum), color = "red") +
geom_line(aes(y = MF_HH_sum), color = "blue") +
labs(x = "Age of source", y = "Relative intensity")
p
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Drop unnecessary columns
yng_grid[, c("FM_OOH", "FM_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = FM_OOH_sum), color = "red") +
geom_line(aes(y = FM_HH_sum), color = "blue") +
labs(x = "Age of source", y = "Relative intensity")
p
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Drop unnecessary columns
yng_grid[, c("FM_OOH", "FM_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = FM_OOH_sum), color = "red") +
geom_line(aes(y = FM_HH_sum), color = "blue") +
labs(x = "Age of source (Female)", y = "Relative intensity")
p
yng_grid
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Drop unnecessary columns
#yng_grid[, c("FM_OOH", "FM_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = FM_OOH_sum), color = "red") +
geom_line(aes(y = FM_HH_sum), color = "blue") +
labs(x = "Age of source (Female)", y = "Relative intensity")
p
# Extract relevant intensities and add to previous data.table
intensity_MF_OOH <- final_intensities[[3]]
intensity_MF_HH <- final_intensities[[4]]
yng_grid$MF_OOH <- intensity_MF_OOH[recip_15_24_indices]
yng_grid$MF_HH <- intensity_MF_HH[recip_15_24_indices]
# Calculate intensities among young people by age of source
yng_grid[, MF_OOH_sum := sum(MF_OOH), by = Var1]
yng_grid[, MF_HH_sum := sum(MF_HH), by = Var1]
# Drop unnecessary columns
yng_grid[, c("MF_OOH", "MF_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = MF_OOH_sum), color = "red") +
geom_line(aes(y = MF_HH_sum), color = "blue") +
labs(x = "Age of source (Male)", y = "Relative intensity")
p
# Extract relevant intensities and add to previous data.table
intensity_MF_OOH <- final_intensities[[3]]
intensity_MF_HH <- final_intensities[[4]]
yng_grid$MF_OOH <- intensity_MF_OOH[recip_15_24_indices]
yng_grid$MF_HH <- intensity_MF_HH[recip_15_24_indices]
# Calculate intensities among young people by age of source
yng_grid[, MF_OOH_sum := sum(MF_OOH), by = Var1]
yng_grid[, MF_HH_sum := sum(MF_HH), by = Var1]
# Drop unnecessary columns
#yng_grid[, c("MF_OOH", "MF_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = MF_OOH_sum), color = "red") +
geom_line(aes(y = MF_HH_sum), color = "blue") +
labs(x = "Age of source (Male)", y = "Relative intensity")
p
# Load in packages and data
#library(cmdstanr)
library(posterior)
library(bayesplot)
library(ggplot2)
library(data.table)
# Load CmdStanR fits
fit_norm <- readRDS(here::here("data", "logit_pairs_draws_ordered.rds"))
#fit_beta <- readRDS(here::here("data", "beta_pairs_draws_ordered.rds"))
# Extract rates (eta)
eta_draws <- as_draws_matrix(fit_norm$draws("eta"))
eta_sums <- rowSums(eta_draws)
eta_prop <- eta_draws / eta_sums
# Check proportion of HH vs OOH
eta_HH_prop <- rowSums(eta_prop[, c(2,4)])
summary(eta_HH_prop)
print(quantile(eta_HH_prop, c(0.025, 0.975))) # 95% CI
# Load in pairs data
filename <- here::here("data", "pairs_tsi.csv")
pairs_tsi <- read.csv(filename)
setDT(pairs_tsi)
# Check whether same household pairs are the same community
same_hh_pairs <- pairs_tsi[same_hh == 1]
source_comm <- same_hh_pairs[,.(COMM.SOURCE)]
recip_comm <- same_hh_pairs[,.(COMM.RECIPIENT)]
t(source_comm == recip_comm)
# Extract relevant intensities and add to previous data.table
intensity_MF_OOH <- final_intensities[[3]]
intensity_MF_HH <- final_intensities[[4]]
yng_grid$MF_OOH <- intensity_MF_OOH[recip_15_24_indices]
yng_grid$MF_HH <- intensity_MF_HH[recip_15_24_indices]
# Calculate intensities among young people by age of source
yng_grid[, MF_OOH_sum := sum(MF_OOH), by = Var1]
yng_grid[, MF_HH_sum := sum(MF_HH), by = Var1]
# Drop unnecessary columns
#yng_grid[, c("MF_OOH", "MF_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = MF_OOH_sum), color = "red") +
geom_line(aes(y = MF_HH_sum), color = "blue") +
labs(x = "Age of source (Male)", y = "Relative intensity",
title = "MF transmission HH vs non-HH intensity",
caption = "Among young (16-24) recipients")
p
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Drop unnecessary columns
#yng_grid[, c("FM_OOH", "FM_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = FM_OOH_sum, color = "Out-of-household")) +
geom_line(aes(y = FM_HH_sum, color = "Within household")) +
labs(x = "Age of source (Female)", y = "Relative intensity",
title = "FM transmission HH vs non-HH intensity",
caption = "Among young (16-24) recipients")
p
# Extract relevant intensities and combine into one data.table
intensity_FM_OOH <- final_intensities[[1]]
intensity_FM_HH <- final_intensities[[2]]
recip_15_24_indices <- which(grid$Var2 < 24) # X: Source, Y: Recipient
yng_grid <- grid[recip_15_24_indices, ]
yng_grid$FM_OOH <- intensity_FM_OOH[recip_15_24_indices]
yng_grid$FM_HH <- intensity_FM_HH[recip_15_24_indices]
setDT(yng_grid)
# Calculate intensities among young people by age of source
yng_grid[, FM_OOH_sum := sum(FM_OOH), by = Var1]
yng_grid[, FM_HH_sum := sum(FM_HH), by = Var1]
# Drop unnecessary columns
#yng_grid[, c("FM_OOH", "FM_HH", "Var2") := NULL]
# Plot intensities
p <- ggplot(yng_grid, aes(x = Var1)) +
geom_line(aes(y = FM_OOH_sum, color = "Out-of-household")) +
geom_line(aes(y = FM_HH_sum, color = "Within household")) +
labs(x = "Age of source (Female)", y = "Relative intensity",
title = "FM transmission HH vs non-HH intensity",
caption = "Among young (16-24) recipients",
color = NULL)
p
