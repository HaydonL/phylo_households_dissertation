sexes <- c("M", "F")
hhs <- c(0, 1)
for (sex in sexes){
for (hh in hhs){
plot_contour(sex, hh)
}
}
par(mfrow = c(2, 2))
for (sex in sexes){
for (hh in hhs){
plot_contour(sex, hh)
}
}
plot_contour("M", 0)
par(mfrow = c(2, 2))
for (sex in sexes){
for (hh in hhs){
plot_contour(sex, hh)
}
}
?plot
plot_contour <- function(sex, hh){
dataset <- pairs_tsi %>% filter(same_hh == hh) %>%
filter(SEX.SOURCE == sex) %>%
dplyr::select(AGE_TRANSMISSION.SOURCE, AGE_INFECTION.RECIPIENT)
if (sex == "M"){
direction <- "Male to female"
} else {
direction <- "Female to male"
}
if (hh){
end <- "within household"
} else {
end <- "out of household"
}
title <- paste(direction, end, sep = ", ")
kde(dataset) %>% plot(xlab="Age of source",
ylab = "Age of recipient",
main = title)
points(dataset, pch = 4, col = alpha("black", 0.3))
}
sexes <- c("M", "F")
hhs <- c(0, 1)
pdf("contours.pdf")
par(mfrow = c(2, 2))
for (sex in sexes){
for (hh in hhs){
plot_contour(sex, hh)
}
}
dev.off()
library(cmdstanr)
check_cmdstan_toolchain(fix = TRUE, quiet = TRUE)
library(posterior)
library(bayesplot)
color_scheme_set("brightblue")
modelpath <- here::here("stan-models", "beta_count_2D.stan")
data <- read.csv(filename)
filename <- here::here("data", "simulated", "runif2D_1.csv")
filename <- here::here("data", "simulated", "runif2D_1.csv")
modelpath <- here::here("stan-models", "beta_count_2D.stan")
data <- read.csv(filename)
stan_data3 <- list(
N = dim(data)[1],
ages = data,
min_age = 0,
max_age = 1
)
modelpath3 <- here::here("stan-models", "beta_indep_test.stan")
model3 <- cmdstan_model(modelpath3)
model3 <- cmdstan_model(modelpath3)
model3 <- cmdstan_model(modelpath3)
model3 <- cmdstan_model(modelpath3)
model3 <- cmdstan_model(modelpath3)
fit3 <- model3$sample(
data = stan_data3,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
mcmc_hist(fit3$draws("mus"))
mcmc_hist(fit3$draws("mus"))
model3 <- cmdstan_model(modelpath3)
fit3 <- model3$sample(
data = stan_data3,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
mcmc_hist(fit3$draws("mus"))
model3 <- cmdstan_model(modelpath3)
fit3 <- model3$sample(
data = stan_data3,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
fit3 <- model3$sample(
data = stan_data3,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
mcmc_hist(fit3$draws("mus"))
stan_data <- list(
N = dim(data)[1],
N_group = 1,
ages = data,
group_nos = rep(1, dim(data)[1]),
min_age = 0,
max_age = 1
)
model <- cmdstan_model(modelpath)
fit <- model$sample(
data = stan_data,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
mcmc_hist(fit$draws("mus"))
datA
data
plot(data)
mcmc_hist(fit$draws("psis"))
fit$summary
fit$summary()
mcmc_hist(fit$draws("eta"))
stan_data4 <- list(
N = dim(data)[1],
K = 10,
ages = data,
min_age = 0,
max_age = 1
)
modelpath4 <- here::here("stan-models", "beta_mixture_DP_one_group.stan.stan")
model4 <- cmdstan_model(modelpath4)
modelpath4 <- here::here("stan-models", "beta_mixture_DP_one_group.stan")
model4 <- cmdstan_model(modelpath4)
model4 <- cmdstan_model(modelpath4)
model4 <- cmdstan_model(modelpath4)
model4 <- cmdstan_model(modelpath4)
fit4 <- model4$sample(
data = stan_data4,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
fit4$draws("psis")
mcmc_hist(fit4$draws("psis"))
stan_data4 <- list(
N = dim(data)[1],
K = 10,
ages = data,
min_age = 0,
max_age = 1
)
modelpath4 <- here::here("stan-models", "beta_mixture_DP_one_group.stan")
model4 <- cmdstan_model(modelpath4)
model4 <- cmdstan_model(modelpath4)
model4 <- cmdstan_model(modelpath4)
fit4 <- model4$sample(
data = stan_data4,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
fit4$summary()
fit4$draws("weights")
mcmc_hist(fit4$draws("weights"))
print(fit4$summary())
print(fit4$summary(), n=101)
stan_data4 <- list(
N = dim(data)[1],
K = 2,
ages = data,
min_age = 0,
max_age = 1
)
fit4 <- model4$sample(
data = stan_data4,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
fit4 <- model4$sample(
data = stan_data4,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
fit4 <- model4$sample(
data = stan_data4,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
stan_data4 <- list(
N = dim(data)[1],
K = 4,
ages = data,
min_age = 0,
max_age = 1
)
fit4 <- model4$sample(
data = stan_data4,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
print(fit4$summary(), n=101)
mcmc_hist(fit4$draws("psis"))
rate <- 500
data <- simulate_PP(rate, rline, sd = 0.1)
write.csv(data, paste0(outdir, "/runif2D_1.csv"), row.names = FALSE)
# Load in helper functions
source(here::here("helper-functions", "simulate_PP.R"))
source(here::here("helper-functions", "runif2D.R"))
source(here::here("helper-functions", "rline.R"))
outdir <- here::here("data", "simulated")
set.seed(5417326)
rate <- 500
data <- simulate_PP(rate, line, sd = 0.1)
write.csv(data, paste0(outdir, "/rline_1.csv"), row.names = FALSE)
data <- simulate_PP(rate, line)
rate <- 500
data <- simulate_PP(rate, line)
write.csv(data, paste0(outdir, "/rline_1.csv"), row.names = FALSE)
set.seed(5417326)
rate <- 500
data <- simulate_PP(rate, rline, sd = 0.1)
write.csv(data, paste0(outdir, "/rline_1.csv"), row.names = FALSE)
filename <- here::here("data", "simulated", "rline_1.csv")
modelpath <- here::here("stan-models", "beta_count_2D.stan")
data <- read.csv(filename)
stan_data4 <- list(
N = dim(data)[1],
K = 4,
ages = data,
min_age = 0,
max_age = 1
)
fit4 <- model4$sample(
data = stan_data4,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
rate <- 200
data <- simulate_PP(rate, rline, sd = 0.1)
write.csv(data, paste0(outdir, "/rline_1.csv"), row.names = FALSE)
filename <- here::here("data", "simulated", "rline_1.csv")
modelpath <- here::here("stan-models", "beta_count_2D.stan")
data <- read.csv(filename)
stan_data4 <- list(
N = dim(data)[1],
K = 4,
ages = data,
min_age = 0,
max_age = 1
)
fit4 <- model4$sample(
data = stan_data4,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
print(fit4$summary(), n=101)
print(fit4$summary(), n=101)
data
data[1]
stan_data5 <- list(
K = 4,
N = dim(data)[1],
y= data[1],
alpha_shape = 1,
alpha_rate = 1,
sigma_shape = 1,
sigma_rate = 1
)
stan_data5 <- list(
K = 4,
N = dim(data)[1],
y= data[1],
alpha_shape = 1,
alpha_rate = 1,
sigma_shape = 1,
sigma_rate = 1
)
modelpath5 <- here::here("stan-models", "GPmixture.stan")
model5 <- cmdstan_model(modelpath5)
library(cmdstanr)
check_cmdstan_toolchain(fix = TRUE, quiet = TRUE)
library(posterior)
library(bayesplot)
color_scheme_set("brightblue")
filename <- here::here("data", "simulated", "rline_1.csv")
modelpath <- here::here("stan-models", "beta_count_2D.stan")
data <- read.csv(filename)
model5 <- cmdstan_model(modelpath5)
fit5 <- model5$sample(
data = stan_data5,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
fit5 <- model5$sample(
data = stan_data5,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
stan_data5 <- list(
K = 4,
N = 300,
y= rnorm(300),
alpha_shape = 1,
alpha_rate = 1,
sigma_shape = 1,
sigma_rate = 1
)
fit5 <- model5$sample(
data = stan_data5,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
fit5$summary
fit5$summary()
stan_data5 <- list(
K = 3,
N = 300,
y = rnorm(300),
alpha_shape = 1,
alpha_rate = 1,
sigma_shape = 1,
sigma_rate = 1
)
fit5 <- model5$sample(
data = stan_data5,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
fit5$summary()
stan_data5 <- list(
K = 20,
N = 300,
y = rnorm(300),
alpha_shape = 1,
alpha_rate = 1,
sigma_shape = 1,
sigma_rate = 1
)
modelpath5 <- here::here("stan-models", "GPmixture.stan")
model5 <- cmdstan_model(modelpath5)
fit5 <- model5$sample(
data = stan_data5,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
fit5$summary()
mcmc_hist(fit5$draws("mu"))
mcmc_hist(fit5$draws("mu"))
stan_data <- list(
N = dim(data)[1],
N_group = 1,
ages = data,
group_nos = rep(1, dim(data)[1]),
min_age = 0,
max_age = 1
)
model <- cmdstan_model(modelpath)
fit <- model$sample(
data = stan_data,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 500,
iter_sampling = 2000
)
fit$summary()
fit <- model$sample(
data = stan_data,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 100,
iter_sampling = 5000
)
fit <- model$sample(
data = stan_data,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 1000,
iter_sampling = 5000
)
fit$summary()
mcmc_hist(fit$draws("mus"))
traceplot(fit)
fit$traceplot()
fit$traceplot
plot(fit$draws("mus"))
plot(fit$draws(""))
class(fit)
mcmc_trace(fit)
mcmc_trace(fit$draws())
plot(data)
mcmc_trace(fit$draws())
stan_data4 <- list(
N = dim(data)[1],
K = 3,
ages = data,
min_age = 0,
max_age = 1
)
modelpath4 <- here::here("stan-models", "beta_mixture_DP_one_group.stan")
model4 <- cmdstan_model(modelpath4)
fit4 <- model4$sample(
data = stan_data4,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 1000,
iter_sampling = 3000
)
fit4$summary()
mcmc_hist(fit4$draws("mus"))
mcmc_trace(fit4$draws("mus"))
modelpath4 <- here::here("stan-models", "beta_mixture_DP_one_group.stan")
model4 <- cmdstan_model(modelpath4)
fit4 <- model4$sample(
data = stan_data4,
seed = 846125,
chains = 4,
parallel_chains = 4,
refresh = 500,
iter_warmup = 1000,
iter_sampling = 3000
)
fit4$summary()
mcmc_hist(fit4$draws("mus"))
mcmc_trace(fit4$draws("mus"))
fit4$summary()
pdf("beta_mixture_DP_hist.pdf")
mcmc_hist(fit4$draws("mus"))
dev.off()
pdf("beta_mixture_DP_trace.pdf")
mcmc_trace(fit4$draws("mus"))
dev.off()
mcmc_trace(fit4$draws("alpha"))
install.packages("label.swich")
install.packages("label.swich")
