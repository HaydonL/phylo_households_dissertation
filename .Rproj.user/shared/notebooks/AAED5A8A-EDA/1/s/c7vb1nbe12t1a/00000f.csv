"0","# AB: it's clearer to perform operations here. "
"0","# less prone to bugs, more readable, and can focus on graphics only in ggplot snippet"
"0","p1_data <- pairs_tsi[ ,{"
"0","    N.in.inland <- sum(COMM.RECIPIENT == 'inland')"
"0","    binom.confs <- (.N*binconf(N.in.inland, .N)) |> as.list()"
"0","    names(binom.confs) <- c('BC.center', 'BC.min', 'BC.max')"
"0","    binom.confs"
"0","    }, by=same_hh]"
"0",""
"0","# Plot number of counts by comm & hh factor"
"0","p1_new <- ggplot(pairs_tsi, aes(x = as.logical(same_hh), "
"0","                                fill = COMM.RECIPIENT)) +"
"0","    geom_bar() +"
"0","    geom_errorbar(data = p1_data, aes(ymin = BC.min, ymax = BC.max, fill = NA), "
"0","                  width = 0.4, colour = ""black"", alpha = 0.9, linewidth = 1.3) +"
"0","    labs(x='Transmission type',"
"0","        y='Number of infections',"
"0","        fill='recipient community') +"
"0","    scale_x_discrete(labels=c(""Out of hh"",""Within hh"")) "
"2","Warning: [38;5;232mIgnoring unknown aesthetics: [32mfill[38;5;232m[39m"
"0","# Plot proportions of infections by household factor"
"0","p2<-ggplot(data = pairs_tsi, aes(x = as.logical(same_hh),fill = COMM.RECIPIENT)) +"
"0","  geom_bar(position=""fill"") +"
"0","  labs(x='Transmission type',"
"0","    y='Proportion of infections',"
"0","    fill='Recipient community') +"
"0","  scale_x_discrete(labels=c(""Out of HH"",""Within HH"")) +"
"0","  geom_errorbar( aes(x='FALSE', ymin=binconf(nrow(pairs_tsi_diff_hh[COMM.RECIPIENT=='inland',]),nrow(pairs_tsi_diff_hh))[2], ymax=binconf(nrow(pairs_tsi_diff_hh[COMM.RECIPIENT=='inland',]),nrow(pairs_tsi_diff_hh))[3]), width=0.4, colour=""black"", alpha=0.9, linewidth=1.3)+"
"0","  geom_errorbar( aes(x='TRUE', ymin=binconf(nrow(pairs_tsi_same_hh[COMM.RECIPIENT=='inland',]),nrow(pairs_tsi_same_hh))[2], ymax=binconf(nrow(pairs_tsi_same_hh[COMM.RECIPIENT=='inland',]),nrow(pairs_tsi_same_hh))[3]), width=0.4, colour=""black"", alpha=0.9, linewidth=1.3)"
"0",""
"0","# Combine above plots into one"
"0","p <- ggarrange(p1_new, p2, ncol=2, nrow=1, common.legend = TRUE,"
"0","               legend=""bottom"")"
"0","p2 <- annotate_figure(p, top=""Colored by recipient community"")"
"0","annotate_figure(p2, top=""Infections within and out of household"")"
